{% ckan_extends %}

{% block form %}
{{ super() }}

{% import 'macros/form.html' as form %}

{% asset 'ckanext-multiuploader/my-css' %}
{% asset 'ckanext-multiuploader/my-js' %}

{% set data = data or {} %}
{% set errors = errors or {} %}
{% set action = h.url_for('multiuploader.upload_resources', _external=True) %}
{% set cancelUrl = h.url_for('multiuploader.delete_uploaded_resources', _external=True) %}

<input type="hidden" value="{{action}}" id="dest_url">
<input type="hidden" value="{{cancelUrl}}" id="cancel_upload_url">

<form id="multiupload" class="dataset-form dataset-resource-form" method="post" action=""
    data-module="basic-form resource-form2" enctype="multipart/form-data">
    {{ h.csrf_input() }}
    <input id="id" value="{{ data.id }}" type="hidden" />
    <input id="pck_id" value="{{ pkg_name }}" type="hidden" />
    {% snippet 'package/snippets/progress_bar_modal.html' %}

    <input type="hidden" id="upload_limit" value={{h.get_max_upload_size()}}>
    <div class="alert alert-danger" id="file-danger">
        {{_('You need to upload file(s) or add a Link ' )}}
    </div>
    <div class="alert alert-danger" id="file-danger-size">
        {{_('Please check your file(s) size. Each file has to be less than ' ) + h.get_max_upload_size() + ' GB'}}
    </div>
    <div class="alert alert-warning upload-related-parts" id="file-size-info-box">
        <p>
            {{_('Please note: Maximum size for a single file is limited to ') + h.get_max_upload_size() + ' GB.'}}
        </p>
    </div>
    <div id='urlBox'>
        {{ form.input('url', id='urlText', label=_('URL'), placeholder=_('http://example.com/my-image.jpg'),
        value=data.name, error=errors.name, classes=['control-full']) }}
        <button type="button" class="btn btn-primary" id="urlRemove">Remove</button>
        <br><br>
        {{ form.input('urlName', id='urlName', label=_('Name'), placeholder=_('eg. January 2011 Gold Prices'),
        value=data.name, error=errors.name, classes=['control-full']) }}
    </div>
    <input type="file" name="urls[]" multiple="multiple" id="fileUpload">
    <div id="fileNameBox" class="upload-related-parts">
        <label for="fileNames">{{_('Files')}}</label>
        <div class="row" id="fileNames">
            <div id="fileNameMessage">
                <i class="fa fa-arrows-alt"></i>
                {{_('Drop file(s) here or use the Upload button')}}
            </div>
        </div>
        <br><br>
    </div>

    <div class="form-actions">
        {% if data.id %}
        {% if h.check_access('resource_delete', {'id': data.id}) %}
        <a class="btn btn-danger pull-left"
            href="{% url_for dataset_type ~ '_resource.delete', resource_id=data.id, id=pkg_name %}"
            data-module="confirm-action"
            data-module-content="{{ _('Are you sure you want to delete this resource?') }}">{%
            block delete_button_text %}{{ _('Delete') }}{% endblock %}</a>
        {% endif %}
        {% endif %}
        {% if stage %}
        <button class="btn btn-default" name="msave" value="go-dataset" type="submit">{{ _('Previous') }}</button>
        {% endif %}
        {% if stage %}
        <button id="ckanext_multiuploader_finish" class="btn btn-primary" name="msave" value="go-metadata"
            type="submit">{{ _('Finish') }}</button>
        {% else %}
        <button class="btn btn-primary" name="msave" value="go-dataset-complete" type="submit">{{ _('Add') }}</button>
        {% endif %}
    </div>
</form>
{% endblock %}